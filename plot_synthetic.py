import matplotlib.pyplot as plt

import pandas as pd
import argparse
import numpy as np

parser = argparse.ArgumentParser()

parser.add_argument('--input_file', type=str)
parser.add_argument('--output_prefix', type=str)
parser.add_argument('--m', default=5, type=int)
parser.add_argument('--M', default=5, type=int)
parser.add_argument('--guidelines', action='store_true')
parser.add_argument('--theory_loss', action='store_true')

colors = ["tab:blue", "tab:orange", "tab:green", "tab:red", "tab:purple"]
figsize = (3.5, 2.5)
# xi_list = [3.2911, 2.9455, 2.4364, 2.2479, 1.7337] # linear
# xi_list = [3.7250, 2.6565, 2.5022, 2.0319, 1.8616]  # relu

# xi_list = [1.2178702354431152, 0.25055184960365295, 0.18341028690338135, 0.13612841069698334, 0.11761107295751572, 0.10946356505155563, 0.10752859711647034, 0.08552954345941544, 0.07961933314800262, 0.07959238439798355, 0.07605067640542984, 0.07018903642892838, 0.0690147802233696, 0.06744611263275146, 0.06691654771566391, 0.06659574061632156, 0.06529875099658966, 0.06485502421855927, 0.06400538980960846, 0.06206168606877327, 0.061477430164813995, 0.06101619824767113, 0.06070360168814659, 0.0603429414331913, 0.05996791273355484, 0.059579551219940186, 0.05915282666683197, 0.059105705469846725, 0.058347299695014954, 0.058291830122470856, 0.0581490583717823, 0.05772613361477852, 0.05741105228662491, 0.057326141744852066, 0.057055387645959854, 0.056942570954561234, 0.05685506761074066, 0.05660904943943024, 0.05653005838394165, 0.05590774491429329, 0.05590537562966347, 0.05572144314646721, 0.05561429262161255, 0.05543481931090355, 0.055397503077983856, 0.05517446994781494, 0.054830484092235565, 0.05474325269460678, 0.05445192754268646, 0.05442364886403084, 0.054201316088438034, 0.05403357371687889, 0.05388282611966133, 0.053847797214984894, 0.053747355937957764, 0.05361659452319145, 0.053290531039237976, 0.05303286761045456, 0.05286555737257004, 0.052848931401968, 0.05270453169941902, 0.05241737142205238, 0.05226224660873413, 0.05192363262176514, 0.051886867731809616, 0.05180627852678299, 0.05178666487336159, 0.051334965974092484, 0.05131819471716881, 0.05113046243786812, 0.051094863563776016, 0.05107428506016731, 0.05090893432497978, 0.05070982128381729, 0.050687529146671295, 0.05022639408707619, 0.05020029470324516, 0.05010611563920975, 0.049730926752090454, 0.04958350583910942, 0.04955076798796654, 0.04938364028930664, 0.04925413429737091, 0.04904657602310181, 0.04900802671909332, 0.04893414303660393, 0.04885885491967201, 0.04878874868154526, 0.04859961196780205, 0.04830280318856239, 0.04816430062055588, 0.04812426492571831, 0.04807784780859947, 0.04805517569184303, 0.047960493713617325, 0.04775769263505936, 0.04773562774062157, 0.047654226422309875, 0.04747192561626434, 0.047419872134923935, 0.04733900725841522, 0.04731196537613869, 0.04716399312019348, 0.04698026552796364, 0.046546030789613724, 0.04651712253689766, 0.04629362374544144, 0.04628823697566986, 0.046153027564287186, 0.045993171632289886, 0.0459098145365715, 0.045684266835451126, 0.045630358159542084, 0.04555743932723999, 0.04555262625217438, 0.04554680734872818, 0.0452929250895977, 0.045247882604599, 0.04522961750626564, 0.045046545565128326, 0.04476616904139519, 0.04474736377596855, 0.04455304890871048, 0.044489189982414246, 0.04443816840648651, 0.04434620589017868, 0.044102396816015244, 0.04397568106651306, 0.04388448968529701, 0.04386485368013382, 0.04371897876262665, 0.043615490198135376, 0.043474230915308, 0.0433281809091568, 0.04325024411082268, 0.04318779706954956, 0.043085530400276184, 0.043054260313510895, 0.04299171268939972, 0.042924631386995316, 0.04273205250501633, 0.04269903153181076, 0.04265571013092995, 0.04240424558520317, 0.0423172265291214, 0.04221472144126892, 0.04215974733233452, 0.0420074388384819, 0.04193604364991188, 0.04187777638435364, 0.041837796568870544, 0.041692424565553665, 0.041407108306884766, 0.04137945547699928, 0.04129621759057045, 0.041227832436561584, 0.041070953011512756, 0.041021592915058136, 0.04101577401161194, 0.04091641306877136, 0.04075487703084946, 0.0405547097325325, 0.04038035497069359, 0.04035596549510956, 0.040170107036828995, 0.040039774030447006, 0.040004558861255646, 0.03985505923628807, 0.039833225309848785, 0.03966239467263222, 0.039493996649980545, 0.03947358950972557, 0.03946352377533913, 0.03929610922932625, 0.03922050818800926, 0.03910619392991066, 0.03910217061638832, 0.03895995765924454, 0.03876512497663498, 0.038732558488845825, 0.038540519773960114, 0.03853835165500641, 0.03849814459681511, 0.038484081625938416, 0.03833558037877083, 0.038203999400138855, 0.03816187381744385, 0.03808142617344856, 0.03806143254041672, 0.037874072790145874, 0.037742555141448975, 0.03765014559030533, 0.03754451125860214, 0.037404488772153854, 0.037388384342193604, 0.037246398627758026, 0.03706564009189606, 0.03701961040496826, 0.03699750453233719, 0.036800552159547806, 0.03679753839969635, 0.036709487438201904, 0.03662838786840439, 0.0365121066570282, 0.036459021270275116, 0.0363202802836895, 0.036248065531253815, 0.03611474484205246, 0.036071550101041794, 0.03593829274177551, 0.03588445484638214, 0.03582511842250824, 0.03576205298304558, 0.03571915626525879, 0.035490985959768295, 0.03547599911689758, 0.035412564873695374, 0.03531113266944885, 0.03528479486703873, 0.0351017527282238, 0.03503411263227463, 0.03498582914471626, 0.03492528945207596, 0.03480810672044754, 0.034768715500831604, 0.03459037095308304, 0.034560676664114, 0.034535761922597885, 0.034335654228925705, 0.03424859419465065, 0.03414300084114075, 0.03403099253773689, 0.03400155156850815, 0.03383597731590271, 0.03382609412074089, 0.03374461829662323, 0.033625826239585876, 0.03347237408161163, 0.03345704451203346, 0.03328699618577957, 0.03324228152632713, 0.033192336559295654, 0.0330425463616848, 0.03284540772438049, 0.03283984214067459, 0.032769281417131424, 0.03258175030350685, 0.03255639225244522, 0.032484494149684906, 0.03246232867240906, 0.032400041818618774, 0.03232916444540024, 0.032228726893663406, 0.03210674226284027, 0.032075732946395874, 0.03201791271567345, 0.0319550484418869, 0.03180847316980362, 0.03173420578241348, 0.03170318529009819, 0.03164243698120117, 0.03146688640117645, 0.03133918344974518, 0.03125099465250969, 0.03113085776567459, 0.03105098381638527, 0.031004946678876877, 0.03092385269701481, 0.030886167660355568, 0.030780356377363205, 0.030689924955368042, 0.03065740317106247, 0.030617618933320045, 0.03047604113817215, 0.03037029132246971, 0.0303485244512558, 0.030263751745224, 0.030115881934762, 0.030091550201177597, 0.030069326981902122, 0.02993912808597088, 0.02976352348923683, 0.02967570722103119, 0.02962363325059414, 0.029509495943784714, 0.029473301023244858, 0.02940169721841812, 0.02925950102508068, 0.029201015830039978, 0.029155606403946877, 0.029088884592056274, 0.028956936672329903, 0.02890014462172985, 0.02883146144449711, 0.028814705088734627, 0.028714938089251518, 0.028657911345362663, 0.028570054098963737, 0.028446268290281296, 0.028361568227410316, 0.02834070846438408, 0.028148334473371506, 0.028121568262577057, 0.028104763478040695, 0.027949320152401924, 0.027775336056947708, 0.02771303430199623, 0.027649544179439545, 0.027588631957769394, 0.02755735069513321, 0.02755306102335453, 0.027389325201511383, 0.027274934574961662, 0.027176368981599808, 0.02710323967039585, 0.026996919885277748, 0.026916634291410446, 0.026897383853793144, 0.02678116224706173, 0.02663327008485794, 0.026615388691425323, 0.026448389515280724, 0.02636411413550377, 0.026258885860443115, 0.026239031925797462, 0.026136143133044243, 0.026071347296237946, 0.026059085503220558, 0.025913409888744354, 0.02586217038333416, 0.02583715133368969, 0.025666164234280586, 0.0256323404610157, 0.025498390197753906, 0.025487152859568596, 0.025409996509552002, 0.02540041133761406, 0.02523382380604744, 0.025194626301527023, 0.02518799901008606, 0.02506013587117195, 0.024995259940624237, 0.024876240640878677, 0.02480999194085598, 0.02478835918009281, 0.02465088851749897, 0.024569068104028702, 0.024513881653547287, 0.02447672374546528, 0.024396011605858803, 0.024197574704885483, 0.02413010410964489, 0.024032248184084892, 0.024015450850129128, 0.023898178711533546, 0.02387513592839241, 0.023793866857886314, 0.023790771141648293, 0.02358296699821949, 0.023547273129224777, 0.023486634716391563, 0.02340257354080677, 0.02328484132885933, 0.02326829731464386, 0.023156633600592613, 0.023056721314787865, 0.022982574999332428, 0.02284592017531395, 0.022838354110717773, 0.022759579122066498, 0.022675026208162308, 0.022517627105116844, 0.022410403937101364, 0.022340819239616394, 0.02231547422707081, 0.022248830646276474, 0.02216772921383381, 0.022124042734503746, 0.02207806706428528, 0.022027092054486275, 0.021970292553305626, 0.02191161923110485, 0.021904097869992256, 0.021830059587955475, 0.02182014472782612, 0.021715885028243065, 0.02156144008040428, 0.02154701203107834, 0.021387159824371338, 0.021239645779132843, 0.021197695285081863, 0.02111538127064705, 0.021033011376857758, 0.02098422311246395, 0.020886359736323357, 0.020876219496130943, 0.020748227834701538, 0.020685922354459763, 0.02057149074971676,
#            0.020550061017274857, 0.020528966560959816, 0.02039116621017456, 0.020373443141579628, 0.020289510488510132, 0.020170267671346664, 0.020101064816117287, 0.020086506381630898, 0.020021522417664528, 0.019914278760552406, 0.019833572208881378, 0.01971594989299774, 0.01969224214553833, 0.01960235834121704, 0.019429877400398254, 0.019375884905457497, 0.019368093460798264, 0.01927473209798336, 0.01926415041089058, 0.01912342570722103, 0.019106410443782806, 0.01898304745554924, 0.018973132595419884, 0.018803849816322327, 0.01872362196445465, 0.01868460513651371, 0.018663449212908745, 0.018537120893597603, 0.01840507611632347, 0.018401319161057472, 0.018392499536275864, 0.018299590796232224, 0.018250958994030952, 0.018183669075369835, 0.01803162880241871, 0.017863472923636436, 0.017820941284298897, 0.01776168681681156, 0.01761109009385109, 0.017603017389774323, 0.01757073774933815, 0.017470039427280426, 0.017415836453437805, 0.01734502986073494, 0.017294440418481827, 0.017267610877752304, 0.017228031530976295, 0.017161203548312187, 0.01701570861041546, 0.01699466072022915, 0.016976000741124153, 0.01690230704843998, 0.016791732981801033, 0.016736211255192757, 0.016601091250777245, 0.016583357006311417, 0.016519643366336823, 0.016473595052957535, 0.01646963506937027, 0.01628783717751503, 0.016281813383102417, 0.016153734177350998, 0.016060134395956993, 0.01605868898332119, 0.01600497215986252, 0.0159302968531847, 0.015861406922340393, 0.015795797109603882, 0.015695426613092422, 0.01568271778523922, 0.015549182891845703, 0.015520499087870121, 0.015508566983044147, 0.015464170835912228, 0.015204677358269691, 0.015112155117094517, 0.015059220604598522, 0.015037184581160545, 0.014958437532186508, 0.014925776980817318, 0.014841197058558464, 0.014819593168795109, 0.014758095145225525, 0.014701579697430134, 0.014596771448850632, 0.014539111405611038, 0.01448106113821268, 0.01442257221788168, 0.014313357882201672, 0.014196713455021381, 0.014135552570223808, 0.014085706323385239, 0.013998450711369514, 0.013984612189233303, 0.01383859571069479, 0.013751762919127941, 0.013628893531858921, 0.013582590967416763, 0.013514732010662556, 0.013390965759754181, 0.013353213667869568, 0.013353091664612293, 0.013250572606921196, 0.013164122588932514, 0.013156617060303688, 0.01312943920493126, 0.01302593294531107, 0.01299958024173975, 0.01296551525592804, 0.01293909177184105, 0.012925701215863228, 0.012595661915838718, 0.012533285655081272, 0.012467904016375542, 0.012440505437552929, 0.012434403412044048, 0.012238782830536366, 0.012235799804329872, 0.012133782729506493, 0.012034665793180466, 0.012012581340968609, 0.01200147159397602, 0.011889076791703701, 0.011802292428910732, 0.011784695088863373, 0.011659753508865833, 0.011576494202017784, 0.011511093005537987, 0.01147739589214325, 0.011445999145507812, 0.011398524977266788, 0.011362145654857159, 0.011214825324714184, 0.011161376722157001, 0.011063843034207821, 0.01100756973028183, 0.01097031682729721, 0.010952654294669628, 0.010778870433568954, 0.010756139643490314, 0.010743692517280579, 0.010675519704818726, 0.010619718581438065, 0.010479356162250042, 0.010428840294480324, 0.010394719429314137, 0.010382689535617828, 0.010323092341423035, 0.010281837545335293, 0.010247721336781979, 0.010182528756558895, 0.010136935859918594, 0.010062904097139835, 0.01004808209836483, 0.009921649470925331, 0.00988100841641426, 0.009842541068792343, 0.009800918400287628, 0.009732941165566444, 0.009657632559537888, 0.009567712433636189, 0.009499147534370422, 0.009369069710373878, 0.009276526048779488, 0.009273895993828773, 0.009144263342022896, 0.009127515368163586, 0.00908725056797266, 0.008993727155029774, 0.00894123874604702, 0.008840103633701801, 0.008793609216809273, 0.008781743235886097, 0.008687597699463367, 0.00855331216007471, 0.008547592908143997, 0.008410143665969372, 0.008376499637961388, 0.008264872245490551, 0.008247067220509052, 0.008233226835727692, 0.008160249330103397, 0.008104164153337479, 0.008027659729123116, 0.007985725998878479, 0.007905385456979275, 0.007822060026228428, 0.007777487393468618, 0.007718333043158054, 0.0075818500481545925, 0.007576820440590382, 0.007460222579538822, 0.007448763120919466, 0.007426140829920769, 0.007381364703178406, 0.007223575841635466, 0.007152434904128313, 0.007063259370625019, 0.0070510730147361755, 0.006996457464993, 0.006938796024769545, 0.0068808626383543015, 0.0068201227113604546, 0.006736456882208586, 0.006640671286731958, 0.006579561624675989, 0.00657822098582983, 0.006537573877722025, 0.006427880376577377, 0.0063944929279387, 0.006329945754259825, 0.006298658903688192, 0.006213915068656206, 0.00621145311743021, 0.006106934044510126, 0.00609557842835784, 0.005987370386719704, 0.005949418526142836, 0.005922191776335239, 0.005893728230148554, 0.005743164569139481, 0.005738409701734781, 0.0056104473769664764, 0.005599540658295155, 0.005578252021223307, 0.005554649047553539, 0.005424980539828539, 0.005363577511161566, 0.005312086082994938, 0.005288528744131327, 0.005190807860344648, 0.005170358810573816, 0.005039435811340809, 0.004976244177669287, 0.004937622230499983, 0.004843274597078562, 0.004769541788846254, 0.004685660824179649, 0.0046553658321499825, 0.00459155160933733, 0.004525742493569851, 0.004505414981395006, 0.004470657557249069, 0.0044692871160805225, 0.004340986721217632, 0.004251660779118538, 0.004182062577456236, 0.004177937284111977, 0.004089669324457645, 0.004027673043310642, 0.004018993116915226, 0.003912376239895821, 0.0037992247380316257, 0.0037900737952440977, 0.0036340325605124235, 0.003626727731898427, 0.003564738668501377, 0.003549591638147831, 0.0034967809915542603, 0.003381695132702589, 0.003374570282176137, 0.003287142375484109, 0.003281226148828864, 0.003133101388812065, 0.003122524591162801, 0.003067184006795287, 0.002982558449730277, 0.0029232227243483067, 0.002851793309673667, 0.002805242082104087, 0.0027634440921247005, 0.0027019591070711613, 0.002627790905535221, 0.0025619743391871452, 0.002479187212884426, 0.002388635417446494, 0.002379663521423936, 0.002333532553166151, 0.002234358573332429, 0.002182606142014265, 0.002133428817614913, 0.002105903811752796, 0.002079406287521124, 0.002011246047914028, 0.001987704774364829, 0.0019157917704433203, 0.0019111022120341659, 0.001820084173232317, 0.0018117750296369195, 0.0017915894277393818, 0.0017096115043386817, 0.0016377493739128113, 0.0015568225644528866, 0.0015264214016497135, 0.0014574752422049642, 0.0013631618348881602, 0.001307771191932261, 0.001259039854630828, 0.0011746601667255163, 0.0011676508001983166, 0.0010721958242356777, 0.001013612956739962, 0.0009070236701518297, 0.0008421503589488566, 0.0008180986042134464, 0.0007435776060447097, 0.0006598009495064616, 0.0006396775133907795, 0.0005740186315961182, 0.0005717864842154086, 0.00047645706217736006, 0.000360840029316023, 0.00028746583848260343, 0.0002468916936777532, 0.00020249625958967954, 0.0001916596374940127, 8.040425018407404e-05, 1.9336610421305522e-05, 2.903628626427235e-07, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08, 6.083074310936354e-08]
# xi_list = sorted(xi_list)

# print(xi_list)

# xi2_list = [xi ** 2 for xi in xi_list]
# xi2_list = [11.8407, 10.2102,  5.8561,  4.9906,  2.4817]
xi2_list = [1.2178702354431152,
 0.25055184960365295,
 0.18341028690338135,
 0.13612841069698334,
 0.11761107295751572,
 0.10946356505155563,
 0.10752859711647034,
 0.08552954345941544,
 0.07961933314800262,
 0.07959238439798355,
 0.07605067640542984,
 0.07018903642892838,
 0.0690147802233696,
 0.06744611263275146,
 0.06691654771566391,
 0.06659574061632156,
 0.06529875099658966,
 0.06485502421855927,
 0.06400538980960846,
 0.06206168606877327,
 0.061477430164813995,
 0.06101619824767113,
 0.06070360168814659,
 0.0603429414331913,
 0.05996791273355484,
 0.059579551219940186,
 0.05915282666683197,
 0.059105705469846725,
 0.058347299695014954,
 0.058291830122470856,
 0.0581490583717823,
 0.05772613361477852,
 0.05741105228662491,
 0.057326141744852066,
 0.057055387645959854,
 0.056942570954561234,
 0.05685506761074066,
 0.05660904943943024,
 0.05653005838394165,
 0.05590774491429329,
 0.05590537562966347,
 0.05572144314646721,
 0.05561429262161255,
 0.05543481931090355,
 0.055397503077983856,
 0.05517446994781494,
 0.054830484092235565,
 0.05474325269460678,
 0.05445192754268646,
 0.05442364886403084,
 0.054201316088438034,
 0.05403357371687889,
 0.05388282611966133,
 0.053847797214984894,
 0.053747355937957764,
 0.05361659452319145,
 0.053290531039237976,
 0.05303286761045456,
 0.05286555737257004,
 0.052848931401968,
 0.05270453169941902,
 0.05241737142205238,
 0.05226224660873413,
 0.05192363262176514,
 0.051886867731809616,
 0.05180627852678299,
 0.05178666487336159,
 0.051334965974092484,
 0.05131819471716881,
 0.05113046243786812,
 0.051094863563776016,
 0.05107428506016731,
 0.05090893432497978,
 0.05070982128381729,
 0.050687529146671295,
 0.05022639408707619,
 0.05020029470324516,
 0.05010611563920975,
 0.049730926752090454,
 0.04958350583910942,
 0.04955076798796654,
 0.04938364028930664,
 0.04925413429737091,
 0.04904657602310181,
 0.04900802671909332,
 0.04893414303660393,
 0.04885885491967201,
 0.04878874868154526,
 0.04859961196780205,
 0.04830280318856239,
 0.04816430062055588,
 0.04812426492571831,
 0.04807784780859947,
 0.04805517569184303,
 0.047960493713617325,
 0.04775769263505936,
 0.04773562774062157,
 0.047654226422309875,
 0.04747192561626434,
 0.047419872134923935,
 0.04733900725841522,
 0.04731196537613869,
 0.04716399312019348,
 0.04698026552796364,
 0.046546030789613724,
 0.04651712253689766,
 0.04629362374544144,
 0.04628823697566986,
 0.046153027564287186,
 0.045993171632289886,
 0.0459098145365715,
 0.045684266835451126,
 0.045630358159542084,
 0.04555743932723999,
 0.04555262625217438,
 0.04554680734872818,
 0.0452929250895977,
 0.045247882604599,
 0.04522961750626564,
 0.045046545565128326,
 0.04476616904139519,
 0.04474736377596855,
 0.04455304890871048,
 0.044489189982414246,
 0.04443816840648651,
 0.04434620589017868,
 0.044102396816015244,
 0.04397568106651306,
 0.04388448968529701,
 0.04386485368013382,
 0.04371897876262665,
 0.043615490198135376,
 0.043474230915308,
 0.0433281809091568,
 0.04325024411082268,
 0.04318779706954956,
 0.043085530400276184,
 0.043054260313510895,
 0.04299171268939972,
 0.042924631386995316,
 0.04273205250501633,
 0.04269903153181076,
 0.04265571013092995,
 0.04240424558520317,
 0.0423172265291214,
 0.04221472144126892,
 0.04215974733233452,
 0.0420074388384819,
 0.04193604364991188,
 0.04187777638435364,
 0.041837796568870544,
 0.041692424565553665,
 0.041407108306884766,
 0.04137945547699928,
 0.04129621759057045,
 0.041227832436561584,
 0.041070953011512756,
 0.041021592915058136,
 0.04101577401161194,
 0.04091641306877136,
 0.04075487703084946,
 0.0405547097325325,
 0.04038035497069359,
 0.04035596549510956,
 0.040170107036828995,
 0.040039774030447006,
 0.040004558861255646,
 0.03985505923628807,
 0.039833225309848785,
 0.03966239467263222,
 0.039493996649980545,
 0.03947358950972557,
 0.03946352377533913,
 0.03929610922932625,
 0.03922050818800926,
 0.03910619392991066,
 0.03910217061638832,
 0.03895995765924454,
 0.03876512497663498,
 0.038732558488845825,
 0.038540519773960114,
 0.03853835165500641,
 0.03849814459681511,
 0.038484081625938416,
 0.03833558037877083,
 0.038203999400138855,
 0.03816187381744385,
 0.03808142617344856,
 0.03806143254041672,
 0.037874072790145874,
 0.037742555141448975,
 0.03765014559030533,
 0.03754451125860214,
 0.037404488772153854,
 0.037388384342193604,
 0.037246398627758026,
 0.03706564009189606,
 0.03701961040496826,
 0.03699750453233719,
 0.036800552159547806,
 0.03679753839969635,
 0.036709487438201904,
 0.03662838786840439,
 0.0365121066570282,
 0.036459021270275116,
 0.0363202802836895,
 0.036248065531253815,
 0.03611474484205246,
 0.036071550101041794,
 0.03593829274177551,
 0.03588445484638214,
 0.03582511842250824,
 0.03576205298304558,
 0.03571915626525879,
 0.035490985959768295,
 0.03547599911689758,
 0.035412564873695374,
 0.03531113266944885,
 0.03528479486703873,
 0.0351017527282238,
 0.03503411263227463,
 0.03498582914471626,
 0.03492528945207596,
 0.03480810672044754,
 0.034768715500831604,
 0.03459037095308304,
 0.034560676664114,
 0.034535761922597885,
 0.034335654228925705,
 0.03424859419465065,
 0.03414300084114075,
 0.03403099253773689,
 0.03400155156850815,
 0.03383597731590271,
 0.03382609412074089,
 0.03374461829662323,
 0.033625826239585876,
 0.03347237408161163,
 0.03345704451203346,
 0.03328699618577957,
 0.03324228152632713,
 0.033192336559295654,
 0.0330425463616848,
 0.03284540772438049,
 0.03283984214067459,
 0.032769281417131424,
 0.03258175030350685,
 0.03255639225244522,
 0.032484494149684906,
 0.03246232867240906,
 0.032400041818618774,
 0.03232916444540024,
 0.032228726893663406,
 0.03210674226284027,
 0.032075732946395874,
 0.03201791271567345,
 0.0319550484418869,
 0.03180847316980362,
 0.03173420578241348,
 0.03170318529009819,
 0.03164243698120117,
 0.03146688640117645,
 0.03133918344974518,
 0.03125099465250969,
 0.03113085776567459,
 0.03105098381638527,
 0.031004946678876877,
 0.03092385269701481,
 0.030886167660355568,
 0.030780356377363205,
 0.030689924955368042,
 0.03065740317106247,
 0.030617618933320045,
 0.03047604113817215,
 0.03037029132246971,
 0.0303485244512558,
 0.030263751745224,
 0.030115881934762,
 0.030091550201177597,
 0.030069326981902122,
 0.02993912808597088,
 0.02976352348923683,
 0.02967570722103119,
 0.02962363325059414,
 0.029509495943784714,
 0.029473301023244858,
 0.02940169721841812,
 0.02925950102508068,
 0.029201015830039978,
 0.029155606403946877,
 0.029088884592056274,
 0.028956936672329903,
 0.02890014462172985,
 0.02883146144449711,
 0.028814705088734627,
 0.028714938089251518,
 0.028657911345362663,
 0.028570054098963737,
 0.028446268290281296,
 0.028361568227410316,
 0.02834070846438408,
 0.028148334473371506,
 0.028121568262577057,
 0.028104763478040695,
 0.027949320152401924,
 0.027775336056947708,
 0.02771303430199623,
 0.027649544179439545,
 0.027588631957769394,
 0.02755735069513321,
 0.02755306102335453,
 0.027389325201511383,
 0.027274934574961662,
 0.027176368981599808,
 0.02710323967039585,
 0.026996919885277748,
 0.026916634291410446,
 0.026897383853793144,
 0.02678116224706173,
 0.02663327008485794,
 0.026615388691425323,
 0.026448389515280724,
 0.02636411413550377,
 0.026258885860443115,
 0.026239031925797462,
 0.026136143133044243,
 0.026071347296237946,
 0.026059085503220558,
 0.025913409888744354,
 0.02586217038333416,
 0.02583715133368969,
 0.025666164234280586,
 0.0256323404610157,
 0.025498390197753906,
 0.025487152859568596,
 0.025409996509552002,
 0.02540041133761406,
 0.02523382380604744,
 0.025194626301527023,
 0.02518799901008606,
 0.02506013587117195,
 0.024995259940624237,
 0.024876240640878677,
 0.02480999194085598,
 0.02478835918009281,
 0.02465088851749897,
 0.024569068104028702,
 0.024513881653547287,
 0.02447672374546528,
 0.024396011605858803,
 0.024197574704885483,
 0.02413010410964489,
 0.024032248184084892,
 0.024015450850129128,
 0.023898178711533546,
 0.02387513592839241,
 0.023793866857886314,
 0.023790771141648293,
 0.02358296699821949,
 0.023547273129224777,
 0.023486634716391563,
 0.02340257354080677,
 0.02328484132885933,
 0.02326829731464386,
 0.023156633600592613,
 0.023056721314787865,
 0.022982574999332428,
 0.02284592017531395,
 0.022838354110717773,
 0.022759579122066498,
 0.022675026208162308,
 0.022517627105116844,
 0.022410403937101364,
 0.022340819239616394,
 0.02231547422707081,
 0.022248830646276474,
 0.02216772921383381,
 0.022124042734503746,
 0.02207806706428528,
 0.022027092054486275,
 0.021970292553305626,
 0.02191161923110485,
 0.021904097869992256,
 0.021830059587955475,
 0.02182014472782612,
 0.021715885028243065,
 0.02156144008040428,
 0.02154701203107834,
 0.021387159824371338,
 0.021239645779132843,
 0.021197695285081863,
 0.02111538127064705,
 0.021033011376857758,
 0.02098422311246395,
 0.020886359736323357,
 0.020876219496130943,
 0.020748227834701538,
 0.020685922354459763,
 0.02057149074971676,
 0.020550061017274857,
 0.020528966560959816,
 0.02039116621017456,
 0.020373443141579628,
 0.020289510488510132,
 0.020170267671346664,
 0.020101064816117287,
 0.020086506381630898,
 0.020021522417664528,
 0.019914278760552406,
 0.019833572208881378,
 0.01971594989299774,
 0.01969224214553833,
 0.01960235834121704,
 0.019429877400398254,
 0.019375884905457497,
 0.019368093460798264,
 0.01927473209798336,
 0.01926415041089058,
 0.01912342570722103,
 0.019106410443782806,
 0.01898304745554924,
 0.018973132595419884,
 0.018803849816322327,
 0.01872362196445465,
 0.01868460513651371,
 0.018663449212908745,
 0.018537120893597603,
 0.01840507611632347,
 0.018401319161057472,
 0.018392499536275864,
 0.018299590796232224,
 0.018250958994030952,
 0.018183669075369835,
 0.01803162880241871,
 0.017863472923636436,
 0.017820941284298897,
 0.01776168681681156,
 0.01761109009385109,
 0.017603017389774323,
 0.01757073774933815,
 0.017470039427280426,
 0.017415836453437805,
 0.01734502986073494,
 0.017294440418481827,
 0.017267610877752304,
 0.017228031530976295,
 0.017161203548312187,
 0.01701570861041546,
 0.01699466072022915,
 0.016976000741124153,
 0.01690230704843998,
 0.016791732981801033,
 0.016736211255192757,
 0.016601091250777245,
 0.016583357006311417,
 0.016519643366336823,
 0.016473595052957535,
 0.01646963506937027,
 0.01628783717751503,
 0.016281813383102417,
 0.016153734177350998,
 0.016060134395956993,
 0.01605868898332119,
 0.01600497215986252,
 0.0159302968531847,
 0.015861406922340393,
 0.015795797109603882,
 0.015695426613092422,
 0.01568271778523922,
 0.015549182891845703,
 0.015520499087870121,
 0.015508566983044147,
 0.015464170835912228,
 0.015204677358269691,
 0.015112155117094517,
 0.015059220604598522,
 0.015037184581160545,
 0.014958437532186508,
 0.014925776980817318,
 0.014841197058558464,
 0.014819593168795109,
 0.014758095145225525,
 0.014701579697430134,
 0.014596771448850632,
 0.014539111405611038,
 0.01448106113821268,
 0.01442257221788168,
 0.014313357882201672,
 0.014196713455021381,
 0.014135552570223808,
 0.014085706323385239,
 0.013998450711369514,
 0.013984612189233303,
 0.01383859571069479,
 0.013751762919127941,
 0.013628893531858921,
 0.013582590967416763,
 0.013514732010662556,
 0.013390965759754181,
 0.013353213667869568,
 0.013353091664612293,
 0.013250572606921196,
 0.013164122588932514,
 0.013156617060303688,
 0.01312943920493126,
 0.01302593294531107,
 0.01299958024173975,
 0.01296551525592804,
 0.01293909177184105,
 0.012925701215863228,
 0.012595661915838718,
 0.012533285655081272,
 0.012467904016375542,
 0.012440505437552929,
 0.012434403412044048,
 0.012238782830536366,
 0.012235799804329872,
 0.012133782729506493,
 0.012034665793180466,
 0.012012581340968609,
 0.01200147159397602,
 0.011889076791703701,
 0.011802292428910732,
 0.011784695088863373,
 0.011659753508865833,
 0.011576494202017784,
 0.011511093005537987,
 0.01147739589214325,
 0.011445999145507812,
 0.011398524977266788,
 0.011362145654857159,
 0.011214825324714184,
 0.011161376722157001,
 0.011063843034207821,
 0.01100756973028183,
 0.01097031682729721,
 0.010952654294669628,
 0.010778870433568954,
 0.010756139643490314,
 0.010743692517280579,
 0.010675519704818726,
 0.010619718581438065,
 0.010479356162250042,
 0.010428840294480324,
 0.010394719429314137,
 0.010382689535617828,
 0.010323092341423035,
 0.010281837545335293,
 0.010247721336781979,
 0.010182528756558895,
 0.010136935859918594,
 0.010062904097139835,
 0.01004808209836483,
 0.009921649470925331,
 0.00988100841641426,
 0.009842541068792343,
 0.009800918400287628,
 0.009732941165566444,
 0.009657632559537888,
 0.009567712433636189,
 0.009499147534370422,
 0.009369069710373878,
 0.009276526048779488,
 0.009273895993828773,
 0.009144263342022896,
 0.009127515368163586,
 0.00908725056797266,
 0.008993727155029774,
 0.00894123874604702,
 0.008840103633701801,
 0.008793609216809273,
 0.008781743235886097,
 0.008687597699463367,
 0.00855331216007471,
 0.008547592908143997,
 0.008410143665969372,
 0.008376499637961388,
 0.008264872245490551,
 0.008247067220509052,
 0.008233226835727692,
 0.008160249330103397,
 0.008104164153337479,
 0.008027659729123116,
 0.007985725998878479,
 0.007905385456979275,
 0.007822060026228428,
 0.007777487393468618,
 0.007718333043158054,
 0.0075818500481545925,
 0.007576820440590382,
 0.007460222579538822,
 0.007448763120919466,
 0.007426140829920769,
 0.007381364703178406,
 0.007223575841635466,
 0.007152434904128313,
 0.007063259370625019,
 0.0070510730147361755,
 0.006996457464993,
 0.006938796024769545,
 0.0068808626383543015,
 0.0068201227113604546,
 0.006736456882208586,
 0.006640671286731958,
 0.006579561624675989,
 0.00657822098582983,
 0.006537573877722025,
 0.006427880376577377,
 0.0063944929279387,
 0.006329945754259825,
 0.006298658903688192,
 0.006213915068656206,
 0.00621145311743021,
 0.006106934044510126,
 0.00609557842835784,
 0.005987370386719704,
 0.005949418526142836,
 0.005922191776335239,
 0.005893728230148554,
 0.005743164569139481,
 0.005738409701734781,
 0.0056104473769664764,
 0.005599540658295155,
 0.005578252021223307,
 0.005554649047553539,
 0.005424980539828539,
 0.005363577511161566,
 0.005312086082994938,
 0.005288528744131327,
 0.005190807860344648,
 0.005170358810573816,
 0.005039435811340809,
 0.004976244177669287,
 0.004937622230499983,
 0.004843274597078562,
 0.004769541788846254,
 0.004685660824179649,
 0.0046553658321499825,
 0.00459155160933733,
 0.004525742493569851,
 0.004505414981395006,
 0.004470657557249069,
 0.0044692871160805225,
 0.004340986721217632,
 0.004251660779118538,
 0.004182062577456236,
 0.004177937284111977,
 0.004089669324457645,
 0.004027673043310642,
 0.004018993116915226,
 0.003912376239895821,
 0.0037992247380316257,
 0.0037900737952440977,
 0.0036340325605124235,
 0.003626727731898427,
 0.003564738668501377,
 0.003549591638147831,
 0.0034967809915542603,
 0.003381695132702589,
 0.003374570282176137,
 0.003287142375484109,
 0.003281226148828864,
 0.003133101388812065,
 0.003122524591162801,
 0.003067184006795287,
 0.002982558449730277,
 0.0029232227243483067,
 0.002851793309673667,
 0.002805242082104087,
 0.0027634440921247005,
 0.0027019591070711613,
 0.002627790905535221,
 0.0025619743391871452,
 0.002479187212884426,
 0.002388635417446494,
 0.002379663521423936,
 0.002333532553166151,
 0.002234358573332429,
 0.002182606142014265,
 0.002133428817614913,
 0.002105903811752796,
 0.002079406287521124,
 0.002011246047914028,
 0.001987704774364829,
 0.0019157917704433203,
 0.0019111022120341659,
 0.001820084173232317,
 0.0018117750296369195,
 0.0017915894277393818,
 0.0017096115043386817,
 0.0016377493739128113,
 0.0015568225644528866,
 0.0015264214016497135,
 0.0014574752422049642,
 0.0013631618348881602,
 0.001307771191932261,
 0.001259039854630828,
 0.0011746601667255163,
 0.0011676508001983166,
 0.0010721958242356777,
 0.001013612956739962,
 0.0009070236701518297,
 0.0008421503589488566,
 0.0008180986042134464,
 0.0007435776060447097,
 0.0006598009495064616,
 0.0006396775133907795,
 0.0005740186315961182,
 0.0005717864842154086,
 0.00047645706217736006,
 0.000360840029316023,
 0.00028746583848260343,
 0.0002468916936777532,
 0.00020249625958967954,
 0.0001916596374940127,
 8.040425018407404e-05,
 1.9336610421305522e-05,
 2.903628626427235e-07,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08,
 6.083074310936354e-08]



def theory_losses(beta):
    total_loss = 0
    rec_loss = 0
    kl_loss = 0
    sigma_list = []
    for i, xi2 in enumerate(xi2_list):
        if len(xi2_list) - i > args.m:
            rec_loss += xi2
        else:
            if beta < xi2:
                sigma = np.sqrt(beta / xi2)
            else:
                sigma = 1
            sigma_list.append(sigma)
            rec_loss += xi2 - max(0, np.sqrt(xi2) - np.sqrt(beta) * sigma) ** 2
            kl_loss += beta * (sigma ** 2 - 1 - 2 * np.log(sigma + 1e-10))

    total_loss = rec_loss + kl_loss
    return total_loss / 2


def plot_loss(args):
    data = pd.read_csv(args.input_file)
    plt.figure(figsize=figsize)

    plt.scatter(data['beta'], data['rec_loss'], marker='d',
                color=colors[1], alpha=0.8, label=r'$\ell_{rec}$')
    plt.scatter(data['beta'], data['kl_loss'], marker='D',
                color=colors[2], alpha=0.8, label=r'$\beta \ell_{KL}$')
    plt.scatter(data['beta'], data['total_loss'], marker='s',
                color=colors[0], alpha=0.8, label=r'$L_{\rm VAE}$')
    # if args.linear:
    # plt.scatter(data['beta'], data['enc_norm'], marker='>', color=colors[3], alpha=0.8, label=r'$\|W\|_F$')
    # plt.scatter(data['beta'], data['dec_norm'], marker='<', color=colors[4], alpha=0.8, label=r'$\|U\|_F$')


    if args.theory_loss:
        beta_list = data['beta'].tolist()
        theory_beta_list = np.linspace(0, max(beta_list), 100).tolist()
        theory_total_loss = []
        for beta in theory_beta_list:
            t = theory_losses(beta)
            theory_total_loss.append(t)
        plt.plot(theory_beta_list, theory_total_loss, alpha=.5, color='black')
    # plt.plot(data['beta'], theory_rec_loss, label='rec')
    # plt.plot(data['beta'], theory_kl_loss, label=r'$\beta$ KL')
    if args.guidelines:
        plt.vlines(x=xi2_list, ymin=0, ymax=20,
                   color='gray', alpha=.5, ls='--')

    plt.legend()
    plt.xlabel(r"$\beta$")
    plt.ylabel("loss")
    plt.tight_layout()
    plt.savefig(f'output/{args.output_prefix}_loss.pdf')


def plot_variance(args):
    data = pd.read_csv(args.input_file)

    m = args.m
    n = len(data)

    sigma_mean_mat = np.zeros((args.M, n))
    sigma_std_mat = np.zeros((args.M, n))

    for i in range(args.M):
        sigma_mean_mat[i] = data[f'sigma-{i}_mean']
        sigma_std_mat[i] = data[f'sigma-{i}_std']

    for i in range(n):
        sids = np.argsort(sigma_mean_mat[:, i])
        sigma_mean_mat[:, i] = sigma_mean_mat[sids, i]
        sigma_std_mat[:, i] = sigma_std_mat[sids, i]

    theory_beta_array = np.linspace(0, data['beta'], 100)

    plt.figure(figsize=figsize)
    markers = ["s", "^", "v", "<", ">"]
    for i in range(m):
        if args.theory_loss:
            plt.plot(theory_beta_array,
                     np.minimum(1, np.sqrt(theory_beta_array / xi2_list[i])),
                     color='black')
        plt.scatter(data['beta'], sigma_mean_mat[i],
                    marker=markers[i % 5], alpha=.8, color=colors[i % 5], label=rf'$\bar \sigma_{i+1}$')
    if args.guidelines:
        plt.vlines(x=xi2_list, ymin=0, ymax=1, color='gray', alpha=.5, ls='--')
    plt.legend()
    plt.xlabel(r"$\beta$")
    plt.ylabel(r"Encoder Standard Deviation")
    plt.tight_layout()
    plt.savefig(f'output/{args.output_prefix}_sigma.pdf')

    plt.figure(figsize=figsize)
    for i in range(m):
        plt.plot(data['beta'], sigma_std_mat[i],
                 marker='d', alpha=.8, color=colors[i % 5], label=rf'std $\sigma_{i+1}$')
    if args.guidelines:
        plt.vlines(x=xi2_list, ymin=0, ymax=.01,
                   color='gray', alpha=.5, ls='--')
    plt.xlabel(r"$\beta$")
    plt.ylabel(r"$\sigma$")
    plt.legend()
    plt.tight_layout()
    plt.savefig(f'output/{args.output_prefix}_sigma_std.pdf')


if __name__ == "__main__":
    args = parser.parse_args()
    data = pd.read_csv(args.input_file)

    plot_loss(args)
    plot_variance(args)
